# Google TODO連携アプリケーション 開発タスク一覧

## 1. プロジェクト初期設定
- [x] Next.jsプロジェクトの作成（v14以上）
- [x] 必要なパッケージのインストール（Material UI、Prisma、next-auth、React Query、Zustand）
- [x] プロジェクト構成の整備
- [x] 環境変数の設定（.env.local）
- [x] Google Cloud Platform設定（OAuth同意画面、認証情報）
- [x] Google Tasks APIの有効化と権限設定

## 2. データベース設計・実装
- [x] Neonアカウント作成とデータベース設定
- [x] Prismaスキーマの定義（User、TaskCustomData、Tag、Priority、統計モデル）
- [x] マイグレーション実行と初期データ投入
- [x] Prismaクライアント設定

## 3. 認証機能実装
- [x] next-auth設定（Google Provider）
- [x] サーバーサイドセッション管理
- [x] ログイン/ログアウトフロー
- [x] 権限管理（API認証）
- [x] 利用規約・プライバシーポリシー同意画面

## 4. バックエンドAPI実装
- [x] APIルート構造設計
- [x] Google Tasks API連携エンドポイント
  - [x] タスクリスト管理（取得/作成/更新/削除）
  - [x] タスク管理（取得/作成/更新/削除/移動/完了状態変更）
- [x] 独自データ管理エンドポイント
  - [x] タスク独自データ（優先度、タグ）
  - [x] タグCRUD操作
- [x] ダッシュボード統計データエンドポイント
- [x] ユーザー管理エンドポイント

## 5. フロントエンド基盤実装
- [x] アプリケーションレイアウト設計
- [x] レスポンシブデザイン対応
- [x] 状態管理設定（Zustand）
- [x] APIキャッシュ設定（React Query）
- [x] 共通UIコンポーネント開発

## 6. タスクリスト/タスク管理UI実装
- [x] タスクリストサイドバーコンポーネント
- [x] タスク一覧表示（DataGrid）
  - [x] ソート機能
  - [x] フィルタリング機能
- [x] タスク詳細表示・編集モーダル
- [x] タスク作成・編集フォーム
- [x] タスク削除機能
- [x] タスク完了状態切替機能
- [x] タスク移動機能
- [x] サブタスク管理

## 7. 独自機能（優先度・タグ付け）実装
- [x] 優先度選択コンポーネント
- [x] タグ選択・管理コンポーネント
- [x] 独自データ連携処理（Google Tasks APIデータとの統合）

## 8. ダッシュボード機能実装
- [x] 統計データ収集・計算ロジック
- [x] 各種グラフコンポーネント
  - [x] 完了数推移グラフ
  - [x] 完了率推移グラフ
  - [x] 作成vs完了グラフ
  - [x] アクティビティヒートマップ
  - [x] 分布円グラフ
- [x] 期間切替機能（日次/週次/月次/年次）

## 9. セキュリティ対策
- [x] CSP設定
- [x] CSRF対策
- [x] 認証トークン安全管理
- [x] エラーハンドリング

## 10. パフォーマンス最適化
- [x] キャッシュ戦略実装
- [x] リクエスト最適化（etag活用）
- [x] ローディング表示
- [x] スケルトン表示

## 11. テスト実装
- [ ] 単体テスト（コンポーネント、API）
- [ ] 結合テスト
- [ ] E2Eテスト
  - [ ] バックエンドE2Eテスト
    - [x] テスト環境構築
      - [x] Jest、SupertestなどのE2Eテストフレームワーク設定
      - [x] テスト用データベース設定
      - [x] Google Tasks APIモックサーバー構築
      - [x] テストユーザー作成とセッション管理
      - [x] Next.js APIルートテスト用環境設定
    - [x] テスト実装の改善
      - [x] APIロジックの分離とテスト容易化
      - [x] ビジネスロジックの分離とモック
      - [x] PrismaのDBクエリのモック実装
      - [x] タグ作成APIのテスト実装改善
      - [x] タスクリスト詳細取得APIのテスト実装改善
      - [x] タスクリスト作成APIのテスト実装改善
      - [x] 全APIエンドポイントのテスト実装（残り）
        - [x] タグ管理テスト（残り）
          - [x] GET /api/tags/[tagId] - タグ詳細取得
          - [x] PATCH /api/tags/[tagId] - タグ更新
          - [x] DELETE /api/tags/[tagId] - タグ削除
        - [x] ユーザー管理テスト（残り）
          - [x] PATCH /api/user - ユーザー情報更新
          - [x] POST /api/user/subscription - サブスクリプションプラン更新
          - [x] DELETE /api/user/delete - アカウント削除
        - [x] タスク独自データテスト
          - [x] GET /api/tasks/custom/[taskId] - タスク独自データ取得
          - [x] PATCH /api/tasks/custom/[taskId] - タスク独自データ更新
          - [x] DELETE /api/tasks/custom/[taskId] - タスク独自データ削除
        - [x] 優先度管理テスト
          - [x] GET /api/priorities - 優先度一覧取得
        - [x] 統計データ管理テスト
          - [x] GET /api/stats/daily - 日次統計データ取得
          - [x] GET /api/stats/weekly - 週次統計データ取得
          - [x] GET /api/stats/monthly - 月次統計データ取得
          - [x] GET /api/stats/yearly - 年次統計データ取得
          - [x] POST /api/stats/update - 統計データ更新
    - [x] 認証関連テスト
      - [x] Googleログインフロー
      - [x] セッション管理
      - [x] 権限チェック
      - [x] 利用規約同意プロセス
    - [x] タスクリスト管理テスト
      - [x] タスクリスト一覧取得テスト（正常系/異常系）
      - [x] タスクリスト作成テスト（正常系/異常系）
      - [x] タスクリスト取得テスト（正常系/異常系）
      - [x] タスクリスト更新テスト（正常系/異常系）
      - [x] タスクリスト削除テスト（正常系/異常系）
    - [x] タスク管理テスト
      - [x] タスク一覧取得テスト（正常系/異常系）
      - [x] タスク作成テスト（正常系/異常系）
      - [x] タスク取得テスト（正常系/異常系）
      - [x] タスク更新テスト（正常系/異常系）
      - [x] タスク削除テスト（正常系/異常系）
      - [x] タスク完了状態切替テスト（正常系/異常系）
      - [x] タスク移動テスト（正常系/異常系）
    - [x] タグ管理テスト
      - [x] タグ一覧取得テスト（正常系/異常系）
      - [x] タグ作成テスト（正常系/異常系）
      - [x] タグ取得テスト（正常系/異常系）
      - [x] タグ更新テスト（正常系/異常系）
      - [x] タグ削除テスト（正常系/異常系）
    - [x] 優先度管理テスト
      - [x] 優先度一覧取得テスト（正常系/異常系）
    - [x] タスク独自データテスト
      - [x] タスク独自データ取得テスト（正常系/異常系）
      - [x] タスク独自データ更新テスト（正常系/異常系）
      - [x] タスク独自データ削除テスト（正常系/異常系）
    - [x] 統計データ管理テスト
      - [x] 日次統計データ取得テスト（正常系/異常系）
      - [x] 週次統計データ取得テスト（正常系/異常系）
      - [x] 月次統計データ取得テスト（正常系/異常系）
      - [x] 年次統計データ取得テスト（正常系/異常系）
      - [x] 統計データ更新テスト（正常系/異常系）
    - [x] ユーザー管理テスト
      - [x] ユーザー情報取得テスト（正常系/異常系）
      - [x] ユーザー情報更新テスト（正常系/異常系）
      - [x] 利用規約同意状態更新テスト（正常系/異常系）
      - [x] サブスクリプションプラン更新テスト（正常系/異常系）
      - [x] アカウント削除テスト（正常系/異常系）
    - [ ] テストカバレッジ測定と改善
      - [x] カバレッジレポート生成
      - [ ] 90%以上のカバレッジ達成のためのテスト追加
        - [ ] auth.tsの認証関連関数のテスト強化
          - [ ] mockAuthenticatedUser関数の分岐カバレッジ向上
          - [ ] mockUnauthenticatedUser関数のテスト拡充
          - [ ] mockMissingAccessToken関数のエッジケーステスト
          - [ ] ユーザーロール別の認証テスト
        - [ ] api-test-utils.tsの未カバー部分のテスト追加
          - [ ] エラーハンドリングパスのテスト強化
          - [ ] トランザクション処理のエッジケーステスト
          - [ ] タスク移動APIのパラメータバリエーションテスト
          - [ ] 統計データAPI内の日付処理エッジケーステスト
        - [ ] 境界値テストの追加
          - [ ] データ入力の最大長テスト
          - [ ] 数値パラメータの上限/下限テスト
          - [ ] 日付範囲の境界値テスト
        - [ ] レアケースのテスト追加
          - [ ] データベース接続エラー時の動作検証
          - [ ] APIレート制限到達時の動作検証
          - [ ] トークン期限切れ時の動作検証
    - [x] エラーケースのテスト
      - [x] ネットワークエラーハンドリングテスト
      - [x] 入力バリデーションテスト
      - [x] 権限エラーテスト
    - [x] 負荷テスト
      - [x] APIエンドポイントの同時多数リクエスト処理テスト
      - [x] データベースの大量データ処理テスト
    - [x] セキュリティテスト
      - [x] 認証バイパステスト
      - [x] APIエンドポイントの不正アクセステスト
      - [x] CSRF保護テスト
  - [ ] フロントエンドE2Eテスト

## 12. デプロイ・CI/CD
- [ ] Vercelデプロイ設定
- [ ] 環境変数設定
- [ ] CI/CD構築（GitHub Actions）
- [ ] エラー監視設定

## 13. 運用準備
- [ ] ドキュメント作成
- [ ] プライバシーポリシー・利用規約作成
- [ ] サポート体制構築 

## 14. タスクリスト/タスク管理UI実装の修正
- [x] タスク削除機能の完全実装
  - [x] TaskDataGrid.tsxのhandleDeleteTask関数にAPIの呼び出しを実装
  - [x] 削除前の確認ダイアログの追加
  - [x] 削除後のUI更新処理の実装
- [x] タスク移動機能の実装
  - [x] タスクの表示順序変更機能（ドラッグ&ドロップまたはボタン）
  - [x] タスク移動APIとの連携実装
  - [x] API呼び出しにエラーハンドリングの追加
- [x] 優先度とタグ表示の実装
  - [x] TaskDataGrid.tsxでの優先度とタグのデータ取得
  - [x] カスタムデータと連携したレンダリング処理
  - [x] フィルタリング機能との連携
- [x] サブタスク管理機能の実装
  - [x] サブタスクのUI表示（階層構造）
  - [x] サブタスク作成・編集・削除機能
  - [x] 親子関係の管理
  - [x] 5階層までのネスト制限の実装 

## 15. 要修正・未実装タスク
- [x] CSP設定の実装
  - [x] next.config.jsでのContent-Security-Policy設定（仕様書4.8.1参照）
  - [x] その他のセキュリティヘッダー設定（X-Content-Type-Options, X-Frame-Options など）
- [x] 統計データの実際のデータ使用
  - [x] DistributionPieChartでのモックデータをAPIデータに置き換え（優先度・タグ分布）
- [x] タグと優先度のフィルタリング実装強化
  - [x] DataGridでのタグでのフィルタリング機能の完全実装
  - [x] 優先度フィルターの完全実装
- [x] レスポンシブデザイン改善
  - [x] モバイル画面でのダッシュボードレイアウト調整
  - [x] タスク一覧画面のモバイル対応強化
- [ ] エラー監視設定
  - [ ] Sentryなどの外部エラー監視サービスの導入検討
- [x] 国際化対応
  - [x] プレースホルダだけでなくi18nライブラリを使用した国際化対応 